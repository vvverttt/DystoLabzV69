"use strict";function _classCallCheck(n,a){if(!(n instanceof a))throw new TypeError("Cannot call a class as a function")}!function(n,a){function t(){return a("(min-width: 768px)").matches}n(document).ready(function(){var a={id:t()?210468425:210469220,width:640,height:t()?853:1140,portrait:!1,title:!1,byline:!1};new Vimeo.Player("road-trip-video",a).on("play",function(){n(".road-trip__vimeo iframe").css("opacity",1)})})}(jQuery,matchMedia);var _createClass=function(){function n(n,a){for(var t=0;t<a.length;t++){var e=a[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}}return function(a,t,e){return t&&n(a.prototype,t),e&&n(a,e),a}}();!function(n){function a(n,a){return n=Math.ceil(n),a=Math.floor(a),Math.floor(Math.random()*(a-n))+n}var t="webkitAnimationEnd oanimationend oAnimationEnd msAnimationEnd animationend",e=[5,3],i=void 0,o=function(){function n(){_classCallCheck(this,n),this.carsIllustration=$("#cars-animation"),this.cars=this.carsIllustration.find(".car"),this.lanes=this.carsIllustration.find(".js-lane"),i=this.carsIllustration.find(".car")[0].outerHTML}return _createClass(n,[{key:"init",value:function(){var n=this;return this.cars.each(function(a,t){n.redrawCar(t)}),this.coin=$('<div class="coin"></div>'),this.wagon=$('<div class="wagon"></div>'),this.carsIllustration.addClass("cars-animation--inited"),this.lanes.each(function(a,t){n.loopLane(t)}),this.initWagonAnimation(),this}},{key:"redrawCar",value:function(n){var t=159*a(0,e[0]),i=130*a(0,e[1]);t=(t?"-":"")+t,i=(i?"-":"")+i,$(n).css({backgroundPosition:t+"px "+i+"px"})}},{key:"loopLane",value:function(n){var a=this,e=0,i=$(n).find(".car");i.one(t,function(t){++e===i.length&&a.resetLane(n,i)})}},{key:"resetLane",value:function(n,a){if($(n).hasClass("lane--with-wagon")||$(n).hasClass("lane--prevent-loop"))return void $(n).addClass("lane--finished");var t=a.length,e=$(n).find(".cars");a.remove();for(var o=0;o<t;o++){var r=$(i);e.append(r),this.redrawCar(r)}this.loopLane(n)}},{key:"allCarsPassed",value:function(n,a){var e=void 0,i=0;e=n.find(".car").length,n.on(t,".car",function(n){++i===e&&a()})}},{key:"initWagonAnimation",value:function(){var n=this;setTimeout(function(){n.currentWagonLane=n.carsIllustration.find(".js-lane").eq(Math.round(2*Math.random())),n.currentWagonLane.addClass("lane--with-wagon"),n.allCarsPassed(n.currentWagonLane,function(){n.sendWagon()})},1e3)}},{key:"sendWagon",value:function(){var n=this;this.currentWagonLane.append([this.coin,this.wagon]),this.wagon.on(t,function(){n.wagon.detach(),n.coin.detach(),n.currentWagonLane.removeClass("lane--with-wagon"),n.lanes.addClass("lane--prevent-loop"),n.resetAllLoops()})}},{key:"resetAllLoops",value:function(){var n=this,a=!0;this.lanes.each(function(n,t){$(t).hasClass("lane--finished")||(a=!1)}),a?(this.lanes.removeClass("lane--prevent-loop").removeClass("lane--finished"),this.lanes.each(function(a,t){n.resetLane(t,$(t).find(".car"))}),this.initWagonAnimation()):setTimeout(function(){n.resetAllLoops()},1e3)}}]),n}();n.CARS=new o}(window),function(n){function a(){var n=navigator.userAgent||navigator.vendor||window.opera;return/windows phone/i.test(n)?"Windows Phone":/android/i.test(n)?"Android":/iPad|iPhone|iPod/.test(n)&&!window.MSStream?"iOS":"unknown"}function t(){var t=n(".store-button");switch(t.hide(),a().toLowerCase()){case"ios":t.not(".store-button--android").show();break;case"android":t.not(".store-button--iphone").show();break;default:return void t.parent().addClass("store-button-container--both-buttons")}}n(document).ready(function(){function a(){r.removeClass("road-trip__water--"+e),e=5!==e?e+1:1,r.addClass("road-trip__water--"+e),setTimeout(a,100)}var e=1,i=document.documentElement,o=window.CARS,r=n(".road-trip__water");t(),setTimeout(function(){o.init(),a(),n(i).addClass("start")},900)})}(jQuery);